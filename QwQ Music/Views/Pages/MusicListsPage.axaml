<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:pages="clr-namespace:QwQ_Music.ViewModels.Pages"
             x:DataType="pages:MusicListsPageViewModel"
             x:Class="QwQ_Music.Views.Pages.MusicListsPage">

    <ScrollViewer Margin="0,0,10,0">

        <Panel>

            <ItemsControl Background="Transparent" ItemsSource="{Binding PlayListItems}" Padding="10,20,10,10">

                <ItemsControl.Styles>
                    <Style Selector="ItemsControl > ContentPresenter">
                        <Setter Property="ContextMenu">
                            <Setter.Value>
                                <ContextMenu>

                                    <MenuItem
                                        Command="{Binding $parent[UserControl].((pages:MusicListsPageViewModel)DataContext).TogglePlaylistCommand}"
                                        CommandParameter="{Binding}"
                                        Header="播放">
                                        <MenuItem.Icon>
                                            <PathIcon Data="{StaticResource SemiIconPlay}" Margin="4" />
                                        </MenuItem.Icon>
                                    </MenuItem>

                                    <MenuItem
                                        Command="{Binding $parent[UserControl].((pages:MusicListsPageViewModel)DataContext).EditMusicListCommand}"
                                        CommandParameter="{Binding}"
                                        Header="编辑">
                                        <MenuItem.Icon>
                                            <PathIcon Data="{StaticResource SemiIconEdit}"
                                                      Margin="2" />
                                        </MenuItem.Icon>
                                    </MenuItem>

                                    <MenuItem
                                        Command="{Binding $parent[UserControl].((pages:MusicListsPageViewModel)DataContext).DeleteMusicListModelCommand}"
                                        CommandParameter="{Binding}"
                                        Header="删除">
                                        <MenuItem.Icon>
                                            <PathIcon Foreground="{DynamicResource EmphasizePink3}"
                                                      Data="{StaticResource SemiIconDelete}"
                                                      Margin="2" />
                                        </MenuItem.Icon>
                                    </MenuItem>

                                </ContextMenu>
                            </Setter.Value>
                        </Setter>
                    </Style>

                    <Style Selector="Button">
                        <Setter Property="Padding" Value="10" />
                        <Setter Property="Foreground" Value="{DynamicResource TextBlockDefaultForeground}" />
                        <Setter Property="CornerRadius" Value="12" />
                        <Setter Property="Background" Value="{DynamicResource SemiColorBackground3}" />

                        <Style Selector="^:pointerover /template/ ContentPresenter#PART_ContentPresenter">
                            <Setter Property="Background" Value="{DynamicResource SemiColorBackground3}" />
                        </Style>

                        <Style Selector="^:pressed /template/ ContentPresenter#PART_ContentPresenter">
                            <Setter Property="Background" Value="{DynamicResource SemiColorBackground3}" />
                        </Style>
                    </Style>

                    <Style Selector="Button:pointerover">
                        <Setter Property="RenderTransform" Value="translateY(-10px)" />
                    </Style>

                    <Style Selector="Button:pressed">
                        <Setter Property="RenderTransform" Value="translateY(0px)" />
                    </Style>

                </ItemsControl.Styles>

                <ItemsControl.ItemsPanel>

                    <ItemsPanelTemplate>
                        <WrapPanel LineSpacing="20" ItemSpacing="20" />
                    </ItemsPanelTemplate>

                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>

                    <DataTemplate>

                        <Button
                            Command="{Binding $parent[UserControl].((pages:MusicListsPageViewModel)DataContext).OpenMusicListsCommand}"
                            CommandParameter="{Binding }">

                            <Button.Transitions>
                                <Transitions>
                                    <TransformOperationsTransition Duration="0:0:0.2" Property="RenderTransform" />
                                </Transitions>
                            </Button.Transitions>

                            <Button.Effect>
                                <DropShadowEffect
                                    BlurRadius="15"
                                    Color="LightGray"
                                    OffsetX="0"
                                    OffsetY="3" />
                            </Button.Effect>

                            <DockPanel
                                Height="60"
                                Width="160"
                                HorizontalSpacing="10"
                                VerticalSpacing="5">

                                <Border DockPanel.Dock="Left"
                                        CornerRadius="12"
                                        VerticalAlignment="Top">

                                    <Border CornerRadius="12"
                                            ClipToBounds="True">
                                        <Image
                                            Source="{Binding CoverImage}" />
                                    </Border>

                                </Border>

                                <StackPanel DockPanel.Dock="Top" Spacing="2">

                                    <TextBlock
                                        TextWrapping="Wrap"
                                        Text="{Binding Name}"
                                        FontWeight="Bold" />

                                    <Separator Margin="0" />

                                </StackPanel>

                                <TextBlock DockPanel.Dock="Bottom"
                                           Text="{Binding Description}"
                                           MaxLines="2"
                                           FontSize="12"
                                           TextTrimming="CharacterEllipsis"
                                           TextWrapping="Wrap"
                                           Classes="Tertiary" />

                            </DockPanel>

                        </Button>

                    </DataTemplate>

                </ItemsControl.ItemTemplate>

                <ItemsControl.ContextMenu>

                    <ContextMenu>
                        <MenuItem Header="新建歌单"
                                  Command="{Binding $parent[UserControl].((pages:MusicListsPageViewModel)DataContext).CreateMusicListCommand}">
                            <MenuItem.Icon>
                                <PathIcon Data="{StaticResource SemiIconMusic}" Margin="2" />
                            </MenuItem.Icon>
                        </MenuItem>
                    </ContextMenu>

                </ItemsControl.ContextMenu>

            </ItemsControl>

            <Button CornerRadius="8" VerticalAlignment="Top" HorizontalAlignment="Left"
                    Theme="{StaticResource OutlineButton}"
                    Margin="20"
                    Command="{Binding CreateMusicListCommand}"
                    IsVisible="{Binding !PlayListItems.Count}" Content="新建歌单" />

        </Panel>

    </ScrollViewer>

</UserControl>